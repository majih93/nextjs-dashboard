# Next.js 공식문서 튜토리얼 따라해보기

# 2장. CSS Styling

Root컴포넌트인 `app/layout.tsx`에 global.css 파일을 import해서 적용되도록 하면 페이지 전체적으로 스타일이 적용됨.

# 3장. Optimizing Fonts and Images

- `next/font`를 사용해서 커스텀 폰트 추가하기
- `next/image`를 사용해서 이미지 추가하기
- Next.js에서 폰트와 이미지가 최적화되는 방식에 대한 이해

**왜 폰트 최적화가 필요한지??**

구글에서 웹사이트 퍼포먼스와 사용성을 측정하는데 사용하는 지표 중에 `Cumulative Layout Shift`라는 개념이 있음.

`layout shift`란, 웹페이지가 로딩되거나 사용자가 상호작용하는 과정에서 배치된 요소들이 예기치 않게 이동하는 현상을 말한다.

사용자의 미스클릭을 유도하거나, 산만함을 유발하는 등 사용자 경험을 해칠 수 있는 요소임.

`layout shift`는 다양한 이유로 발생할 수 있음.

- 이미지 크기 미지정: HTML에서 이미지 크기를 미리 지정하지 않으면 로드되기 전까지 브라우저가 얼마나 공간을 잡아야할지 몰라서 로드된 이후에 레이아웃이 이미지 실제 크기에 따라 변경될 수 있음.

- 비율을 지정하지 않은 비디오/임베드 요소: 마찬가지로 고정된 크기나 비율 지정하지 않으면 컨텐츠 로드되고 레이아웃이 변경될 수 있음.

- 동적 컨텐츠 삽입: 광고 배너 등 동적인 컨텐츠가 로딩 중간에 삽입되면 기존 요소들이 밀려나면서 레이아웃 시프트가 발생할 수 있음.

- 웹 폰트 로드: 폰트를 비동기적으로 로드할 때, 최초 렌더링 시 사용되었던 폰트가 웹폰트로 변경되면서 레이아웃 시프트가 발생할 수 있음.

`Cumulative Layout Shift`란 페이지 로드동안 발생한 레이아웃 시프트 크기 누적하여 계산한 값.

CLS 점수가 높을수록 요소가 많이 이동되었다는 것이고, 사용자가 불편함을 느꼈을 가능성이 높음.

아하 그렇구만. 폰트가 뒤늦게 로드되어서 웹페이지 레이아웃이 변경되는 것처럼 보이는 것을 방지하면 사용자 경험이 개선된다는 점에서 최적화가 필요하다.

Next.js는 이런 현상을 방지하기 위해서 `next/font` 모듈을 사용해서 처리된 폰트의 경우 빌드타임에 폰트를 미리 다운로드 받아서 다른 정적 asset과 같이 hosting한다. 그래서 웹페이지 방문 시, 폰트 로딩을 위한 추가적인 네트워크 요청이 발생하지 않음.

폰트 적용 시 특정 subset - 웹폰트 파일에서 필요한 문자 집합만을 선택하여 추출한 폰트 파일 - 만 적용할 수 있음.

**왜 이미지 최적화가 필요한지?**

이미지와 같은 정적 애셋의 경우 최상위 경로의 `/public` 폴더에 담아서 사용할 수 있음.

Next.js가 제공해주는 최적화없이 이미지를 사용하는 경우, 아래와 같이 HTML에서 img태그를 사용해서 적용함.

```HTML
<img
  src="/hero.png"
  alt="Screenshots of the dashboard project showing desktop version"
/>
```

이렇게 하게되면 이미지에 대해서 다음 작업을 추가로 처리해야 한다.

- 이미지 크기가 화면 크기에 따라 반응해서 변경되도록 처리
- 여러 디바이스에 맞춰서 이미지 크기 지정
- 이미지 로딩에 따른 레이아웃 시프트 방지
- 사용자의 viewport밖에 있는 이미지 lazy loading처리

사실 이미지 최적화는 웹개발에 있어서 그 자체로 하나의 거대한 토픽일만큼 중요하고, 특히 신경써야되는 영역 중 하나.

이런 최적화 작업을 별도로 할 필요없이, Next.js에서 제공하는 `next/image` 모듈을 사용하면 최적화를 처리해준다고 함.

`<Image>` 컴포넌트는 `<img>`태그의 확장버전으로, 아래의 최적화 기능을 제공함.

- 레이아웃 시프트 방지
- 작은 디바이스에서 viewport에 맞지 않는 이미지 resizing
- default로 lazy loading됨 이미지가 (viewport에 들어왔을 때 이미지가 load된다.)
- 브라우저에서 지원되는 경우 `WebP`나 `AVIF`와 같은 최신 포맷으로 제공
